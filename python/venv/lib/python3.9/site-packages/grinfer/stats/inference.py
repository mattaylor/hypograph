from typing import Dict, Any
from ..adapters.base import GraphAdapter

def calculate_density(adapter: GraphAdapter) -> float:
    """
    Calculate the density of the graph.
    Density = 2 * |E| / (|V| * (|V| - 1)) for undirected graphs.
    """
    # Get counts
    node_count_res = adapter.query("MATCH (n) RETURN count(n) as count")
    edge_count_res = adapter.query("MATCH ()-[r]->() RETURN count(r) as count")
    
    node_count = node_count_res[0]['count']
    edge_count = edge_count_res[0]['count']
    
    if node_count < 2:
        return 0.0
        
    return (2 * edge_count) / (node_count * (node_count - 1))

def get_degree_distribution(adapter: GraphAdapter) -> Dict[int, int]:
    """
    Get the degree distribution of the graph.
    Returns a dictionary mapping degree to count of nodes with that degree.
    """
    query = """
    MATCH (n)
    OPTIONAL MATCH (n)-[r]-()
    WITH n, count(r) as degree
    RETURN degree, count(n) as count
    ORDER BY degree
    """
    results = adapter.query(query)
    return {row['degree']: row['count'] for row in results}
